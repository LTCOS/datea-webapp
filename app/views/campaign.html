<div class="campaign-holder ff1" ng-hide="flow.notFound">
	<div class="campaign-card container-fluid">
		<div class="row">
			<div class="col-sm-7 campaign-info">
				<div class="inner">
					<div class="main-info">
						<h1 ng-class="{'title-fix' : flow.titleFix}">{{campaign.name}}</h1>
						<h2>#{{campaign.main_tag.tag}}</h2>
						<p class="shortdesc">{{campaign.short_description}}</p>
						<div class="main-btns">
							<div class="inner">
								<div class="mbtn datear-btn">
									<button class="btn datea-datear-btn btn-lg" ng-click="flow.datear()">Datea <i class="glyphicon glyphicon-map-marker"></i></button><span class="time-left" ng-show="campaign.end_date">{{campaign._timeLeft | date:time }}</span>
								</div>
								<div class="mbtn follow-camp-btn">
									<da-follow follow-obj="tag" follow-id="{{campaign.id}}" btn-class="follow-campaign"></da-follow>
								</div>
								<div class="mbtn share-btn">
								
									<div class="datea-glyph-holder" ng-click="campaign.share()">
										<i class="fa fa-share-alt"></i>
									</div>
									<!--
									<button class="btn btn-default" ng-click="campaign.share()">
										<i class="fa fa-share-alt"></i> compartir
									</button>-->
									<!--
									<div class="input-group">
										<input type="text" class="form-control" ng-model="campaign.shareableUrl">
										<span class="input-group-btn">
											<button class="btn btn-default" type="button" ng-click="campaign.share()"><i class="fa fa-share-alt"></i></button>
										</span>
									</div>-->
								</div>
							</div>
						</div>
						<div class="stats">
							<div class="count-stats" ng-if="campaign.dateo_count > 0 || campaign.follow_count > 0">
								<div class="dateo-count stat" ng-if="campaign.dateo_count > 0">{{campaign.dateo_count}} <ng-pluralize count="campaign.dateo_count" when="{'one':'dateo','other':'dateos'}"></ng-pluralize></div>
								<div class="follow-count stat" ng-if="campaign.follow_count > 0">{{campaign.follow_count}} <ng-pluralize count="campaign.follow_count" when="{'one':'seguidor','other':'seguidores'}"></ng-pluralize></div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-sm-5 hidden-xs campaign-img" da-bg-from-api="{{campaign.image.image}}" da-img-size="contain"></div>
		</div>
	</div>



	<div class="viz-holder">
		<div class="viz-nav">
			<div class="menu-right" ng-hide="flow.showFilter">
				<div class="btn-group main-menu-btn" dropdown is-open="status.isopen">
		      <button type="button" class="btn btn-link dropdown-toggle" ng-disabled="disabled">
		  			<span class="glyphicon glyphicon-cog"></span>
		      </button>
		      <ul class="dropdown-menu dropdown-menu-right" role="menu">
		        <li ng-if="flow.userIsOwner"><a href="#/iniciativas/{{campaign.id}}/edit">Configuración</a></li>
		        <li ng-if="flow.userIsOwner"><a href="#/iniciativas/{{campaign.id}}/admin">Administrar dateos</a></li>
		        <li><a href="#">Insertar (embed)</a></li>
		        <li><a href="#" target="_blank">Imprimir reporte</a></li>
		        <li><a href="http://api.datea.pe/csv-export/dateos/tag/{{campaign.main_tag.id}}/" target="_blank">Descargar dateos en CSV</a></li>
		      </ul>
		    </div>
			</div>
			<div class="search">
				<form class="form search-form" ng-submit="flow.getDateos()">
					<!--<div class="form-group">-->
						<div class="input-group">
							<input type="text" class="form-control" ng-model="query.search">
							<span class="input-group-btn">
								<button class="btn btn-default" type="button"><i class="fa fa-search" ng-click="flow.getDateos()"></i></button>
							</span>
						</div>
					<!--</div>-->
				</form>
				<!--
				<div class="order-by-holder" ng-hide="search.show_orderby">
					<span class="order-by-label">ordernar por:</span>
						<select class="selectpicker" data-style="btn-link" name="orderBy" ng-model="query.orderBy" ng-change="flow.getDateos()">
							<option value="-created">últimos</option>
							<option value="-vote_count">más apoyados</option>
							<option value="-comment_count">más comentados</option>
						</select>
			  </div>
			  -->
			  <div class="filter-control" ng-click="flow.showFilter = !flow.showFilter">
			  	<div class="filter-toggle-link" ng-class="{active: flow.showFilter}"><i class="fa fa-filter"></i></div>
			  	<div class="query-text" ng-hide="flow.showFilter">
			  		viendo: <span class="query-text-item" ng-repeat="text in query.textRep" ng-bind-html="text"></span>
			  	</div>
			  </div>
			</div>
			<div class="filter-holder" ng-show="flow.showFilter">
				<div class="container-fluid">
					<div class="row">
						<div class="col-xs-8 col-sm-7 col-md-7 col-lg-7">
							<div class="owner-filter query-item">
								<div class="form-group">
									<label>Aprobados por</label>
									<div class="checkbox">
										<label>
											<input type="checkbox" ng-model="query.owner" /> <strong>{{campaign.user.username}}</strong>
										</label>
									</div>
								</div>
							</div>
							<div class="date-filter query-item">
								<div class="form-group">
									<label>filtrar fecha</label>
									<div class="form-inline">
										<label>del</label>
										<input type="text" class="form-control since" ng-model="query.since" datepicker-popup="yyyy/MM/dd" is-open="flow.sincePopup" ng-focus="flow.sincePopup = true" />
										<label>al</label>
										<input type="text" class="form-control until" ng-model="query.until" datepicker-popup="yyyy/MM/dd" is-open="flow.untilPopup" ng-focus="flow.untilPopup = true" />
									</div>
								</div>
							</div>
							<div class="category-filter query-item" ng-show="campaign.secondary_tags.length > 0">
								<div class="form-group">
									<label>filtrar etiqueta</label>
									<select class="form-control" ng-model="query.tag" ng-options="item.value as item.label for item in query.tagFilterOptions"></select>
								</div>
							</div>
						</div>
						<div class="col-xs-4 col-sm-5 col-md-5 col-lg-5">
							<!--<h4>Filtros:</h4>-->
							<div class="apply">
								<div class="limit-slider query-item">
									<div class="form-group">
										<label>Cargar {{query.limitLabel}} dateos</label>
										<div class="slider">
											<input type="range" name="points" min="50" max="500" step="50" ng-model="query.limit"> 
										</div>
									</div>
								</div>
								<div class="orderby-control query-item">
									<div class="form-group">
										<label>Ordenar por</label>
										<select class="form-control" ng-model="query.orderBy" ng-options="opt.val as opt.label for opt in query.orderByOptions"></select>
									</div>
								</div>
								<button class="btn btn-lg btn-success pull-left apply-btn" ng-click="query.apply()">APLICAR</button> 
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="viz-viewer" ng-class="{'datea-loading': flow.loading }">
			<div class="protect-cover" ng-show="flow.showFilter" ng-click="flow.showFilter = false"></div>
			<tabset>
				<tab heading="&nbsp;" class="glyphicon glyphicon-map-marker datea-glyphtab-fix" ng-click="flow.activeTab = 'map'" ng-hide="flow.showFilter">
					<div class="container-fluid dateo-map-viz">
						<div class="row">
							<div class="hidden-xs col-sm-45 dateos-holder">
								<div class="dateo-detail-content-holder" ng-show="flow.dateoDetail.show">
									<da-dateo-detail-inline dateo="flow.dateoDetail.dateo" marker-index="flow.dateoDetail.markerIndex"></da-dateo-detail-inline>
								</div>
								<div class="dateo-description-holder" ng-hide="flow.dateoDetail.show">
										<da-dateo-teaser ng-repeat="dateo in campaign.dateos"></da-dateo-teaser>
										<div class="no-results" ng-show="campaign.dateos.length == 0 && flow.query.done">
										Aún no hay dateos en esta iniciativa. ¡Datea!
										</div>
								</div>
							</div>
							<div class="col-xs-12 col-sm-75 leaflet-map-holder" ng-class="{'has-legend': flow.hasLegend}">
								<leaflet id="leafletCampaign" defaults="campaign.leaflet.defaults" markers="campaign.leaflet.markers" center="campaign.leaflet.center" cluster-options="campaign.leaflet.clusterOptions" width="100%" tiles="campaign.leaflet.tiles"></leaflet>
								<div class="legend-holder" ng-show="campaign.secondary_tags.length > 0">
									<div class="expand" ng-click="flow.expandLegend()" ng-show="flow.showLegendExpandLink">ver todas</div>
									<div class="contract" ng-click="flow.contractLegend()" ng-show="flow.showLegendContractLink">cerrar</div>
									<div class="tag-list">
										<div class="tag-legend" ng-repeat="tag in campaign.secondary_tags" da-on-last-repeat="flow.onLegendRender()">
											<span class="color-sample" style="background-color: {{flow.colorRange[$index]}}"></span>
											<span class="tag">#{{tag.tag}}</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</tab>
				<tab heading="&nbsp;" class="glyphicon glyphicon-camera datea-glyphtab-fix" ng-click="flow.activeTab = 'images'" ng-hide="flow.showFilter">
					<div class="dateos-with-images-holder dateo-img-viz"> <!-- ng-style="campaign.dateosWithImagesHolderHeight"> -->
						<da-dateo-thumb ng-repeat="dateo in campaign.dateosWithImages"></da-dateo-thumb>
					</div>
				</tab>
				<tab heading="&nbsp;" class="glyphicon glyphicon-signal datea-glyphtab-fix" ng-click="chart.buildCharts()" ng-show="campaign.dateo_count > 0" ng-click="flow.activeTab = 'stats'" ng-hide="flow.showFilter">
					<div class="dateo-stats-holder" ng-if="statsVisible">
						<div class="container-fluid">
							<div class="row">
								<div class="col-xs-12">
									<div class="inner">
										<div class="chart-type-select pull-right">
											<select class="form-control" ng-model="chart.typeControl" ng-change="chart.changeChartType()">
												<option value="pie">Pie</option>
												<option value="bar">Barras</option>
											</select>
										</div>
										<div data-ac-chart="chart.type" data-ac-data="chart.data" data-ac-config="chart.config" class="viz-simple-chart"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</tab>
			</tabset>
		</div>
	</div>

	<div class="extra-info-holder container-fluid">
		<div class="row">
			<div class="col-xs-45">
				<div class="description">
					<div class="user-info">
						<div class="parts-holder">
							<div class="part part-1">
								<div class="user-img img-circle" da-bg-from-api="{{campaign.user.image}}" da-img-size="cover" da-img-type="user"></div>
							</div>
							<div class="part part-2">
								<p>dater@</p>
								<h3>{{campaign.user.username}}</h3>
							</div>
						</div>
						<h4>#{{campaign.main_tag.tag}}</h4>
						<p class="question">¿Qué buscamos con esta acción?</p>
						<p class="answer answer1" ng-bind-html="campaign.mission | linky:'_blank'"></p>
						<p class="question">¿Qué pasa con la info?</p>
						<p class="answer answer2" ng-bind-html="campaign.information_destiny | linky:'_blank'"></p>
					</div>
				</div>
			</div>
			<div class="col-lg-4 col-md-4 col-sm-8 col-xs-8">
				<div class="social">
					<h5 ng-show="campaign.follow_count > 0">{{campaign.follow_count}} <ng-pluralize count="campaign.follow_count" when="{'one':'seguidor','other':'seguidores'}"></ng-pluralize></h5>
					<!--<button class="btn datea-btn">invita a tus amigos</button>-->
					<div class="followers-holder">
						<a class="follower-image" target="_blank" ng-href="#/{{follower.username}}" ng-repeat="follower in campaign.followers" tooltip="{{follower.username}}" tooltip-trigger="mouseenter">
							<span class="" da-bg-from-api="{{follower.image}}" da-img-size="cover" da-img-type="user"></span>
						</a>
					</div>
					<!--<button class="btn datea-btn datea-btn-xs see-more-peers">ver todos</button>-->

					<div class="related" ng-if="campaign.relatedCampaigns.length > 0">
						<h5>iniciativas relacionadas</h5>
						<span class="tags" ng-repeat="tag in campaign.relatedCampaigns">#{{tag.tag}}</span>
					</div>
				</div>
				<!--
				<div class="part part-2" ng-if="campaign.dateo_count > 0">
					<img src="static/images/campaign/btn-print-report.png" alt="imprimir reporte" ng-click="campaign.print()">
					<a href="http://api.datea.pe/csv-export/dateos/tag/{{campaign.main_tag.id}}/" target="_blank"><img src="static/images/campaign/btn-csv-dl.png" alt="descargar csv"></a>
				</div>
				-->
			</div>
		</div>
	</div>
</div>
<div class="not-found" ng-if="flow.notFound" ng-include="'views/notFound.html'" ng-hide="!flow.notFound">
</div>
